import P from"./toast.esm.803b843c.js";import N from"./button.esm.4087d562.js";import I from"./inputtext.esm.4724b432.js";import K from"./image.esm.4e51bb2e.js";import M from"./column.esm.16afdb9d.js";import H from"./datatable.esm.10e6509c.js";import O from"./dialog.esm.b445a747.js";import W from"./fileupload.esm.7178ae0d.js";import q from"./password.esm.dbfe60e7.js";import G from"./selectbutton.esm.0566a452.js";import{d as Q,b as h,k as i,e as l,w as m,p as J,aj as X,v as Y,al as Z,au as x,a7 as _,av as $,aw as V,ax as F,o as r,Q as y,l as w,h as f,g as b,f as v,t as k,n as L,am as ee,an as se,i as te}from"./entry.a8bdde5b.js";import{l as oe}from"./loader.0ee3e5a0.js";import{f as ie}from"./fastfireauth.e97fa8e2.js";import{f as R}from"./fastfirestore.94989132.js";import{a as g}from"./application.d9f5e52f.js";import{d as le,s as S}from"./utilities.bf6f8ed7.js";import"./portal.esm.f9c19ffd.js";import"./focustrap.esm.aedfac9b.js";import"./paginator.esm.3a93e560.js";import"./dropdown.esm.7450136e.js";import"./overlayeventbus.esm.2d5707d2.js";import"./virtualscroller.esm.77db94c2.js";import"./inputnumber.esm.31182f59.js";import"./message.esm.27bda9ff.js";import"./progressbar.esm.a36bfb4c.js";import"./badge.esm.fc7997bc.js";const d=o=>(ee("data-v-5f7b1f43"),o=o(),se(),o),ae={class:"grid crud-demo"},ne={class:"col-12"},re={class:"card"},de=d(()=>i("b",null,"該当データ 0 件",-1)),me={key:0,class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center"},pe=d(()=>i("h5",{class:"m-0"}," 管理者一覧 ",-1)),ce={class:"block mt-2 md:mt-0 p-input-icon-left"},ue={key:1,class:"flex flex-row justify-content-between md:align-items-center"},he=d(()=>i("small",{class:"m-0"}," 管理者一覧 ",-1)),fe={class:"block p-input-icon-left"},ge={key:2,class:"flex flex-column mt-2 md:flex-row md:justify-content-between md:align-items-center"},we=d(()=>i("h5",{class:"m-0"},"   ",-1)),be={class:"block mt-2 md:mt-0"},ve={class:"p-input-icon-right"},ye=d(()=>i("span",{class:"p-column-title"},"アイコン",-1)),ke=d(()=>i("span",{class:"p-column-title"},"名前",-1)),De=d(()=>i("span",{class:"p-column-title"},"メールアドレス",-1)),Ce=d(()=>i("span",{class:"p-column-title"},"権限",-1)),Ee={key:0,class:"status-badge status-super"},_e={key:1,class:"status-badge status-manager"},$e={key:2,class:"status-badge status-staff"},Ve=d(()=>i("span",{class:"p-column-title"},"作成日",-1)),Fe={class:"flex align-items-center justify-content-center"},Le={class:"p-input-icon-right"},Re={class:"field"},Se=d(()=>i("label",{class:"mb-3"},"アイコン画像",-1)),ze={class:"flex justify-content-center"},Ue={class:"field"},je=d(()=>i("label",{class:"mb-3"},"メールアドレス",-1)),Te={key:0,class:"p-invalid p-error"},Ae={class:"field"},Be=d(()=>i("label",{class:"mb-3"},"パスワード",-1)),Pe={key:0,class:"p-invalid p-error"},Ne={class:"field"},Ie=d(()=>i("label",{class:"mb-3"},"名前",-1)),Ke={key:0,class:"p-invalid p-error"},Me={class:"field"},He=d(()=>i("label",{class:"mb-3"},"権限",-1)),Oe={class:"flex align-items-center justify-content-center"},We=d(()=>i("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem",color:"orange"}},null,-1)),qe={key:0},Ge=d(()=>i("br",null,null,-1)),Qe=X().public,{loadingcount:Cs,showLoading:E,hideLoading:D,hideLoadingForce:Es}=oe(),{$firebaseApp:z}=Y(),Je={data(){return{issp:!1,windowsize:0,tableheigth:100,spsearchDialog:!1,detailDialog:!1,removeDialog:!1,isnew:!1,one:{},cluster:[],page:0,rows:0,loading:!1,searchword:"",perpagerecords:100,totalrecords:0,currentmaxpage:0,currentorderfield:"registerdate",currentorderAD:"desc",uploadfiles:null,imagepreview1:null,roles:[{name:"スタッフ",value:1},{name:"管理者",value:101},{name:"スーパーユーザー",value:999,constant:!0}],submitted:!1}},created(){this.windowsize=window.innerWidth,this.tableheigth=window.innerHeight-377,767>=this.windowsize&&(this.issp=!0,this.tableheigth=window.innerHeight-367)},async mounted(){ie().role.value<100&&Z("/"),window.addEventListener("resize",this.resizeWindow),await this.search(null)},methods:{resizeWindow(){this.windowsize=window.innerWidth,this.tableheigth=window.innerHeight-377,767>=this.windowsize&&(this.issp=!0,this.tableheigth=window.innerHeight-367)},onFileChange(o){if(o.target&&o.target.files&&(this.imagepreview1=null,o.target.files[0])){console.log("event.target.files[0]=",o.target.files[0]),this.uploadfiles=Object.assign({},o.target.files);const e=new FileReader,s=this;e.addEventListener("load",function(){console.log("reader.result=",e.result),s.imagepreview1=e.result},!1),e.readAsDataURL(o.target.files[0])}},clickReset(o){console.log("event.target=",o.target),typeof this.imagepreview1=="string"&&0>this.imagepreview1.indexOf("http")&&(this.one.image?this.imagepreview1=this.one.image:this.imagepreview1=null)},showEdit(o){if(console.log("docindex=",o),this.isnew=!0,this.one={},this.one.role=this.roles[0].value,this.uploadfiles=null,this.imagepreview1=null,this.submitted=!1,o!==null){const e=this.cluster[o];if(e){if(this.isnew=!1,this.one=e.data(),typeof this.one.email=="string"&&0<this.one.email.length){this.one.email=le(this.one.email,null,null);const s=S(this.one.email+":"+Qe.AUTH_MAGIC);console.log("mailhash=",s)}typeof this.one.image=="string"&&0<this.one.image.length&&(this.imagepreview1=this.one.image)}}console.log("this.one=",this.one),this.detailDialog=!0},confirmRemove(o){console.log("docindex=",o);const e=this.cluster[o];e&&(this.one=e.data()),this.removeDialog=!0},async search(o){console.log("arglastdoc=",o),console.log("searchword=",this.searchword);try{this.loading=!0;let e=[];o||(this.totalrecords=0,this.currentmaxpage=0,this.cluster=[],this.$refs.dt.resetPage()),typeof this.searchword=="string"&&0<this.searchword.length&&e.push(["or",x(_("name","==",this.searchword),_("role","==",this.searchword))]),e.push(["available","==",!0]),console.log("whereis=",e);const s=await R().getinstance().gets("managers",e,[[this.currentorderfield,this.currentorderAD]],this.perpagerecords,o);return console.log("result=",s),s.total&&(this.totalrecords=s.total,this.cluster=this.cluster.concat(s.docs)),this.rows=this.perpagerecords,console.log("this.totalrecords=",this.totalrecords),console.log("this.cluster=",this.cluster),!0}catch(e){return console.error("error=",e),!1}finally{this.spsearchDialog=!1,setTimeout(()=>{var n,p,c,u;const e=document.getElementsByClassName("p-selectable-row");if(console.log("_docs1=",e),e)for(var s=0;s<e.length;s++)e[s]&&(e[s].classList.add("nodata"),e[s].classList.remove("isdata"));const a=document.getElementsByClassName("isdataresolve");if(console.log("_docs2=",a),a)for(var s=0;s<a.length;s++)a[s]&&a[s].parentElement&&a[s].parentElement&&((p=(n=a[s].parentElement)==null?void 0:n.parentElement)==null||p.classList.remove("nodata"),(u=(c=a[s].parentElement)==null?void 0:c.parentElement)==null||u.classList.add("isdata"));this.loading=!1},200)}},async save(){if(this.submitted=!0,!(this.one.name&&this.one.name.trim()&&this.one.email&&this.one.email.trim()))return!1;this.one.image=null;let o=!1;if(this.one.uid||(this.one.registerdate=$(),o=!0),o&&!this.one.password)return!1;if(console.log("isnew=",o),this.one.modifydate=$(),this.one.available=!0,this.imagepreview1&&this.uploadfiles&&this.uploadfiles[0]){console.log("this.uploadfiles=",this.uploadfiles);let e=".png";const s=this.uploadfiles[0];(s.type=="image/jpeg"||s.type=="image/jpg")&&(e=".jpg");const a=S(this.imagepreview1)+e;E();const n=await R().upload(this.uploadfiles[0],"images/managers/"+a,function(p,c){console.log("progress=",p)});if(D(),n)this.one.image=n;else return alert("アイコン画像のアップロードに失敗しました。"),!1}E();try{this.one.method="PUT",o&&(this.one.method="POST");const e=await V(F(z,"asia-northeast1"),"manager")(this.one);if(console.log("res=",e),!e)throw o?new Error("auth create fail"):new Error("auth update fail")}catch(e){alert(`保存に失敗しました。

`+e.toLocaleString()),console.log("Error save user:",e);return}finally{D()}o?this.$toast.add({severity:"success",summary:"正常終了",detail:"管理者を追加しました。",life:3e3}):this.$toast.add({severity:"success",summary:"正常終了",detail:"管理者を更新しました。",life:3e3}),this.one={},this.detailDialog=!1,await this.search(null)},async remove(){E();try{this.one.method="DELETE";const o=await V(F(z,"asia-northeast1"),"manager")(this.one);if(console.log("res=",o),!o)throw new Error("auth remove fail")}catch(o){alert("削除に失敗しました。"),console.log("Error remove user:",o),D();return}finally{D()}this.$toast.add({severity:"success",summary:"正常終了",detail:"管理者を削除しました。",life:3e3}),this.one={},this.removeDialog=!1,await this.search(null)},async onRowselect(o){console.log("onRowSelect event.index=",o.index),this.showEdit(o.index)},async onPage(o){if(console.log("page event=",o),this.cluster&&this.currentmaxpage<o.page){const e=this.cluster[this.cluster.length-1];await this.search(e)&&(this.currentmaxpage=o.page)}else setTimeout(()=>{var n,p,c,u;const e=document.getElementsByClassName("p-selectable-row");if(console.log("_docs1=",e),e)for(var s=0;s<e.length;s++)e[s]&&(e[s].classList.add("nodata"),e[s].classList.remove("isdata"));const a=document.getElementsByClassName("isdataresolve");if(console.log("_docs2=",a),a)for(var s=0;s<a.length;s++)a[s]&&a[s].parentElement&&a[s].parentElement&&((p=(n=a[s].parentElement)==null?void 0:n.parentElement)==null||p.classList.remove("nodata"),(u=(c=a[s].parentElement)==null?void 0:c.parentElement)==null||u.classList.add("isdata"))},200);window.scrollTo({left:0,top:0})},async onSort(o){console.log("event=",o),this.currentorderfield=o.sortField,this.currentorderAD=0<o.sortOrder?"asc":"desc",console.log("this.currentorderAD=",this.currentorderAD),await this.search(null)}}},Xe=Q({...Je,__name:"managers",setup(o){return(e,s)=>{const a=P,n=N,p=I,c=K,u=M,U=H,C=O,j=W,T=q,A=G;return r(),h("div",ae,[i("div",ne,[i("div",re,[l(a),l(U,{ref:"dt",value:e.cluster,page:e.page,lazy:"",paginator:"",scrollable:!0,"scroll-height":e.tableheigth+"px",totalRecords:e.totalrecords,loading:e.loading,rows:e.rows,selectionMode:"single",onRowSelect:e.onRowselect,onPage:s[7]||(s[7]=t=>e.onPage(t)),onSort:s[8]||(s[8]=t=>e.onSort(t)),stripedRows:"","paginator-template":"PrevPageLink NextPageLink CurrentPageReport","rows-per-page-options":[10,20,100],"current-page-report-template":"{totalRecords}件中 {first}件目 〜 {last}件目表示中","responsive-layout":"scroll"},{empty:m(()=>[de]),header:m(()=>[e.issp?(r(),h("div",ue,[he,i("span",fe,[l(n,{label:"",icon:"pi pi-plus",class:"p-button-rounded p-button-info ml-5",onClick:s[1]||(s[1]=t=>e.showEdit(null))}),l(n,{label:"",icon:"pi pi-search",class:"p-button-rounded p-button-primary ml-2",onClick:s[2]||(s[2]=t=>e.spsearchDialog=!0)})])])):(r(),h("div",me,[pe,i("span",ce,[l(n,{label:"追加",icon:"pi pi-plus",class:"p-button-info ml-5",onClick:s[0]||(s[0]=t=>e.showEdit(null))})])])),e.issp?w("",!0):(r(),h("div",ge,[we,i("span",be,[i("span",ve,[l(p,{modelValue:e.searchword,"onUpdate:modelValue":s[3]||(s[3]=t=>e.searchword=t),placeholder:"Search...",onKeypress:s[4]||(s[4]=y(t=>e.search(null),["enter"]))},null,8,["modelValue"]),i("i",{class:"pi pi-times",onClick:s[5]||(s[5]=t=>e.searchword="")})]),l(n,{label:"検索",icon:"pi pi-search",class:"p-button-primary ml-2",onClick:s[6]||(s[6]=t=>e.search(null))})])]))]),default:m(()=>[l(u,{field:"image",header:"アイコン",style:{width:"150px"}},{body:m(t=>[ye,f(g).formatFirestoreDoc(e.cluster[t.index],t.field)?(r(),b(c,{key:0,src:f(g).formatFirestoreDoc(e.cluster[t.index],t.field),width:"100",preview:""},null,8,["src"])):f(g).formatFirestoreDoc(e.cluster[t.index],"uid")?(r(),b(c,{key:1,src:"/images/blank_profile.png",width:"100"})):(r(),b(c,{key:2,src:"/images/blank_profile.png",width:"100",style:{visibility:"hidden"}}))]),_:1}),l(u,{field:"name",header:"名前"},{body:m(t=>[ke,v(" "+k(f(g).formatFirestoreDoc(e.cluster[t.index],t.field)),1)]),_:1}),l(u,{field:"email",header:"メールアドレス"},{body:m(t=>[De,v(" "+k(f(g).formatFirestoreDoc(e.cluster[t.index],t.field)),1)]),_:1}),l(u,{field:"role",header:"権限",sortable:!0,style:{width:"150px"}},{body:m(t=>[Ce,f(g).formatFirestoreDoc(e.cluster[t.index],t.field)===999?(r(),h("span",Ee,"スーパーユーザー")):f(g).formatFirestoreDoc(e.cluster[t.index],t.field)>100?(r(),h("span",_e,"管理者")):f(g).formatFirestoreDoc(e.cluster[t.index],t.field)>0?(r(),h("span",$e,"スタッフ")):w("",!0)]),_:1}),l(u,{field:"registerdate",header:"作成日",sortable:!0,style:{width:"200px"}},{body:m(t=>[Ve,v(" "+k(f(g).formatFirestoreDoc(e.cluster[t.index],t.field)),1)]),_:1}),l(u,{style:{width:"150px"}},{body:m(t=>[f(g).formatFirestoreDoc(e.cluster[t.index],"uid")?(r(),b(n,{key:0,icon:"pi pi-pencil",class:"isdataresolve p-button-rounded p-button-info mr-2",onClick:B=>e.showEdit(t.index)},null,8,["onClick"])):w("",!0),f(g).formatFirestoreDoc(e.cluster[t.index],"uid")?(r(),b(n,{key:1,icon:"pi pi-trash",class:"p-button-rounded p-button-danger",onClick:B=>e.confirmRemove(t.index)},null,8,["onClick"])):w("",!0)]),_:1})]),_:1},8,["value","page","scroll-height","totalRecords","loading","rows","onRowSelect"]),l(C,{visible:e.spsearchDialog,"onUpdate:visible":s[14]||(s[14]=t=>e.spsearchDialog=t),style:{width:"450px"},header:"キーワード検索",modal:!0,dismissableMask:!0},{footer:m(()=>[l(n,{label:"キャンセル",icon:"pi pi-times",class:"p-button-text",onClick:s[12]||(s[12]=t=>e.spsearchDialog=!1)}),l(n,{label:"検索",icon:"pi pi-search",class:"p-button-info",onClick:s[13]||(s[13]=t=>e.search(null))})]),default:m(()=>[i("div",Fe,[i("span",Le,[l(p,{modelValue:e.searchword,"onUpdate:modelValue":s[9]||(s[9]=t=>e.searchword=t),placeholder:"Search...",onKeypress:s[10]||(s[10]=y(t=>e.search(null),["enter"]))},null,8,["modelValue"]),i("i",{class:"pi pi-times",onClick:s[11]||(s[11]=t=>e.searchword="")})])])]),_:1},8,["visible"]),l(C,{visible:e.detailDialog,"onUpdate:visible":s[20]||(s[20]=t=>e.detailDialog=t),style:J({width:e.windowsize>834?"calc(100% - 300px - 4rem)":"100%"}),header:"管理者情報",modal:!0,class:"fullscreen p-fluid",position:"right",dismissableMask:!1},{footer:m(()=>[l(n,{label:"キャンセル",icon:"pi pi-times",class:"p-button-danger",onClick:s[19]||(s[19]=t=>e.detailDialog=!1)}),l(n,{label:"保存",icon:"pi pi-check",class:"p-button-info",onClick:e.save},null,8,["onClick"])]),default:m(()=>[i("div",Re,[Se,l(j,{mode:"basic",class:"mb-3",chooseLabel:"ファイル選択",name:"demo[]",accept:"image/jpeg, image/jpg, image/png","max-file-size":1e6,onInput:e.onFileChange,onClick:e.clickReset},null,8,["onInput","onClick"]),i("div",ze,[e.imagepreview1?(r(),b(c,{key:0,src:e.imagepreview1,width:"200",preview:""},null,8,["src"])):(r(),b(c,{key:1,src:"/images/blank_profile.png",width:"200"}))])]),i("div",Ue,[je,l(p,{id:"name",modelValue:e.one.email,"onUpdate:modelValue":s[15]||(s[15]=t=>e.one.email=t),modelModifiers:{trim:!0},required:"true",type:"email",class:L({"p-invalid":e.submitted&&!e.one.email}),onKeypress:y(e.save,["enter"])},null,8,["modelValue","class","onKeypress"]),e.submitted&&!e.one.email?(r(),h("small",Te,"メールアドレスは必須項目です。")):w("",!0)]),i("div",Ae,[Be,l(T,{id:"name",modelValue:e.one.password,"onUpdate:modelValue":s[16]||(s[16]=t=>e.one.password=t),modelModifiers:{trim:!0},"toggle-mask":!0,onKeypress:y(e.save,["enter"])},null,8,["modelValue","onKeypress"]),e.isnew&&e.submitted&&!e.one.password?(r(),h("small",Pe,"パスワードは必須項目です。")):w("",!0)]),i("div",Ne,[Ie,l(p,{id:"name",modelValue:e.one.name,"onUpdate:modelValue":s[17]||(s[17]=t=>e.one.name=t),modelModifiers:{trim:!0},required:"true",class:L({"p-invalid":e.submitted&&!e.one.name}),onKeypress:y(e.save,["enter"])},null,8,["modelValue","class","onKeypress"]),e.submitted&&!e.one.name?(r(),h("small",Ke,"名前は必須項目です。")):w("",!0)]),i("div",Me,[He,l(A,{modelValue:e.one.role,"onUpdate:modelValue":s[18]||(s[18]=t=>e.one.role=t),options:e.roles,optionDisabled:"constant",optionLabel:"name",optionValue:"value"},null,8,["modelValue","options"])])]),_:1},8,["visible","style"]),l(C,{visible:e.removeDialog,"onUpdate:visible":s[22]||(s[22]=t=>e.removeDialog=t),style:{width:"450px"},header:"最終確認",modal:!0,dismissableMask:!0},{footer:m(()=>[l(n,{label:"キャンセル",icon:"pi pi-times",class:"p-button-danger",onClick:s[21]||(s[21]=t=>e.removeDialog=!1)}),l(n,{label:"削除",icon:"pi pi-check",class:"p-button-info",onClick:e.remove},null,8,["onClick"])]),default:m(()=>[i("div",Oe,[We,e.one?(r(),h("span",qe,[v("この管理者「"),i("b",null,k(e.one.name),1),v("」を削除します。"),Ge,v("本当に削除してよろしいですか？?")])):w("",!0)])]),_:1},8,["visible"])])])])}}});const _s=te(Xe,[["__scopeId","data-v-5f7b1f43"]]);export{_s as default};

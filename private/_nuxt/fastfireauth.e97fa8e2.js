import{aj as k,x as i,ap as f,aq as y,ar as A,as as P,at as S}from"./entry.a8bdde5b.js";const b=k().public,x=()=>{const u=i("token",()=>null),s=i("role",()=>0),h=i("authorizeduser",()=>null),c=i("autherror",()=>null),o=i("onAuthStateChangedCallback",()=>null);function d(t){s.value=t}async function v(t,l){console.log("argemail=",t);const n=f();let e=null;return await y(n,t,l).then(a=>{console.log("user created"),console.log(a),e=a.user.uid}).catch(a=>{alert(a.message),console.error(a)}),e}async function m(t,l){return await new Promise((n,e)=>{const a=f();return A(a,t,l).then(r=>{r.user.getIdToken().then(g=>{u.value=g,h.value=r.user,n(!0)}).catch(g=>{c.value=g,n(!1)})}).catch(r=>{c.value=r,n(!1)})})}async function p(){return await new Promise((t,l)=>{const n=f();P(n).then(()=>{u.value=null,t(!0)}).catch(e=>{c.value=e,t(!1)})})}async function w(){return await new Promise((t,l)=>{const n=f();S(n,e=>{e?e.getIdTokenResult().then(a=>{console.log("is result=",a),u&&u.value||(u.value=a.token,console.log("user.uid=",e.uid),-1<b.superuseruids.indexOf(e.uid)?s.value=999:typeof a.claims.role=="number"&&0<a.claims.role&&(s.value=a.claims.role),console.log("role=",s.value),h.value=e),typeof o.value=="function"&&o.value(!0),t()}).catch(l):(typeof o.value=="function"&&o.value(!1),u.value=null,t())},e=>{console.log("error=",e),c.value=e,typeof o.value=="function"&&o.value(!1),l(e)})})}return{setRole:d,createWithEmailAndPass:v,signin:m,signout:p,token:u,role:s,autherror:c,authorizeduser:h,onAuthStateChangedCallback:o,checkAuthState:w}};export{x as f};

import L from"./toast.esm.803b843c.js";import R from"./button.esm.4087d562.js";import K from"./inputtext.esm.4724b432.js";import N from"./column.esm.16afdb9d.js";import U from"./datatable.esm.10e6509c.js";import B from"./dialog.esm.b445a747.js";import j from"./inputnumber.esm.31182f59.js";import{d as I,b as c,k as i,e as a,w as d,p as M,aj as T,v as q,al as A,av as $,aw as H,ax as W,o as l,Q as k,l as f,h as g,g as p,f as y,t as w,F as O,G,n as P,am as Q,an as J,i as X}from"./entry.a8bdde5b.js";import{l as Y}from"./loader.0ee3e5a0.js";import{f as Z}from"./fastfireauth.e97fa8e2.js";import{f as V}from"./fastfirestore.94989132.js";import{a as b}from"./application.d9f5e52f.js";import"./portal.esm.f9c19ffd.js";import"./paginator.esm.3a93e560.js";import"./dropdown.esm.7450136e.js";import"./overlayeventbus.esm.2d5707d2.js";import"./virtualscroller.esm.77db94c2.js";import"./focustrap.esm.aedfac9b.js";import"./utilities.bf6f8ed7.js";const u=o=>(Q("data-v-f650be0e"),o=o(),J(),o),x={class:"grid crud-demo"},ee={class:"col-12"},se={class:"card"},te=u(()=>i("b",null,"該当データ 0 件",-1)),oe={key:0,class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center"},ie=u(()=>i("h5",{class:"m-0"}," ユーザー一覧 ",-1)),le=[ie],ne={key:1,class:"flex flex-row justify-content-between md:align-items-center"},ae=u(()=>i("small",{class:"m-0"}," ユーザー一覧 ",-1)),re={class:"block p-input-icon-left"},de={key:2,class:"flex flex-column mt-2 md:flex-row md:justify-content-between md:align-items-center"},ue=u(()=>i("h5",{class:"m-0"},"   ",-1)),ce={class:"block mt-2 md:mt-0"},pe={class:"p-input-icon-right"},me=u(()=>i("span",{class:"p-column-title"},"メールアドレス",-1)),he=u(()=>i("span",{class:"p-column-title"},"氏名",-1)),fe=u(()=>i("span",{class:"p-column-title"},"電話番号",-1)),ge=u(()=>i("span",{class:"p-column-title"},"Pushトークン",-1)),be=u(()=>i("span",{class:"p-column-title"},"最終アクセス",-1)),we=u(()=>i("span",{class:"p-column-title"},"登録日",-1)),ye={class:"flex align-items-center justify-content-center"},ve={class:"p-input-icon-right"},ke={class:"field"},Ce=u(()=>i("label",{class:"mb-3"},"メーカー名",-1)),De={key:0,class:"mb-5"},$e={key:2,class:"p-invalid p-error"},Ve={class:"field"},Ee=u(()=>i("label",{class:"mb-3"},"URL",-1)),Pe={key:0,class:"mb-5"},ze=["href"],Se={class:"field"},_e=u(()=>i("label",{class:"mb-3"},"並び順",-1)),Fe={key:0,class:"mb-5"},Le={key:0},Re={key:1},Ke={class:"flex align-items-center justify-content-center"},Ne=u(()=>i("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem",color:"orange"}},null,-1)),Ue={key:0},Be=u(()=>i("br",null,null,-1)),S=!1,_=!1;T().public;const{loadingcount:as,showLoading:z,hideLoading:E,hideLoadingForce:rs}=Y(),{$firebaseApp:je}=q(),Ie={data(){return{isSp:!1,debug:!1,usename:S,usetel:_,windowsize:0,tableheigth:100,spsearchDialog:!1,detailDialog:!1,removeDialog:!1,isnew:!1,isdetail:!1,one:{},cluster:[],origindocs:[],page:0,rows:0,loading:!1,searchword:"",perpagerecords:100,totalrecords:0,currentmaxpage:0,currentorderfield:"registerdate",currentorderAD:"desc",uploadfiles:null,imagepreview1:null,submitted:!1}},created(){this.windowsize=window.innerWidth,this.tableheigth=window.innerHeight-302,767>=this.windowsize&&(this.isSp=!0,this.tableheigth=window.innerHeight-262)},async mounted(){Z().role.value<100&&A("/"),this.debug=-1<location.search.indexOf("?debug")||!1,console.log("this.debug=",this.debug),window.addEventListener("resize",this.resizeWindow),await this.search(null)},methods:{resizeWindow(){this.windowsize=window.innerWidth,this.tableheigth=window.innerHeight-302,767>=this.windowsize&&(this.isSp=!0,this.tableheigth=window.innerHeight-262)},showEdit(o){if(console.log("docindex=",o),this.isnew=!0,this.isdetail=!1,this.one={},this.one.rank=0,this.uploadfiles=null,this.imagepreview1=null,this.submitted=!1,o!==null){const e=this.cluster[o];e&&(this.isnew=!1,this.isdetail=!0,this.one=e.data())}console.log("this.one=",this.one),this.detailDialog=!0},confirmRemove(o){console.log("docindex=",o);const e=this.cluster[o];e&&(this.one=e.data()),this.removeDialog=!0},async searchlocal(){typeof this.searchword=="string"&&0<this.searchword.length?(this.$refs.dt.resetPage(),this.cluster=this.origindocs.filter(e=>-1<e.data().email.indexOf(this.searchword)),this.totalrecords=this.cluster.length,console.log("this.totalrecords=",this.totalrecords)):await this.search(null)},async search(o){console.log("arglastdoc=",o),console.log("searchword=",this.searchword);try{this.loading=!0;let e=[];o||(this.totalrecords=0,this.currentmaxpage=0,this.cluster=[],this.$refs.dt.resetPage()),e.push(["available","==",!0]),console.log("whereis=",e);const s=await V().getinstance().gets("persons",e,[[this.currentorderfield,this.currentorderAD]],null,null);return console.log("result=",s),s.total&&(this.origindocs=s.docs,this.cluster=this.origindocs.concat(),this.totalrecords=this.cluster.length),this.rows=this.perpagerecords,console.log("this.totalrecords=",this.totalrecords),console.log("this.cluster=",this.cluster),!0}catch(e){return console.error("error=",e),!1}finally{this.spsearchDialog=!1,setTimeout(()=>{var n,m,h,C;const e=document.getElementsByClassName("p-selectable-row");if(console.log("_docs1=",e),e)for(var s=0;s<e.length;s++)e[s]&&(e[s].classList.add("nodata"),e[s].classList.remove("isdata"));const r=document.getElementsByClassName("isdataresolve");if(console.log("_docs2=",r),r)for(var s=0;s<r.length;s++)r[s]&&r[s].parentElement&&r[s].parentElement&&((m=(n=r[s].parentElement)==null?void 0:n.parentElement)==null||m.classList.remove("nodata"),(C=(h=r[s].parentElement)==null?void 0:h.parentElement)==null||C.classList.add("isdata"));this.loading=!1},200)}},async save(){if(this.submitted=!0,!(this.one.name&&this.one.name.trim()))return!1;let o=!1;this.one.uid||(this.one.registerdate=$(),o=!0),console.log("isnew=",o),this.one.modifydate=$(),this.one.available=!0,z();try{const e=await V().getinstance().set("makers",this.one);if(console.log("res=",e),!e)throw o?new Error("auth create fail"):new Error("auth update fail")}catch(e){alert(`保存に失敗しました。

`+e.toLocaleString()),console.log("Error save user:",e);return}finally{E()}o?this.$toast.add({severity:"success",summary:"正常終了",detail:"メーカーを追加しました。",life:3e3}):this.$toast.add({severity:"success",summary:"正常終了",detail:"メーカーを更新しました。",life:3e3}),this.one={},this.detailDialog=!1,await this.search(null)},async remove(){if(!this.one.uid)return!1;z();try{this.one.modifydate=$(),this.one.available=!1;const o=await V().getinstance().set("makers",this.one);if(console.log("res=",o),!o)throw new Error("auth remove fail")}catch(o){alert("削除に失敗しました。"),console.log("Error remove user:",o),E();return}finally{E()}this.$toast.add({severity:"success",summary:"正常終了",detail:"メーカーを削除しました。",life:3e3}),this.one={},this.removeDialog=!1,await this.search(null)},async onRowselect(o){console.log("onRowSelect event.index=",o.index),this.showEdit(o.index)},async quickPush(o,e){if(o==="fcmtoken"&&!this.debug)return;const s=prompt("Pushのタイトル");if(!s)return;const r=prompt("Pushの本文");if(!r)return;const n=prompt("Pushのリンク");if(confirm(`以下の内容で即時Push通知します。
よろしいですか？

[送信先]`+e+`
[タイトル] `+s+`
[本文] `+r+`
[リンク] `+n)){console.log("title=",s),console.log("body=",r);try{const m=await H(W(je,"asia-northeast1"),"quickpush")({title:s,body:r,link:n,devicetoken:e});console.log("res=",m),alert("送信しました。")}catch(m){console.error("error=",m),alert(`送信に失敗しました。
最初からやり直して下さい。`)}}}}},Me=I({...Ie,__name:"persons",setup(o){return(e,s)=>{const r=L,n=R,m=K,h=N,C=U,D=B,F=j;return l(),c("div",x,[i("div",ee,[i("div",se,[a(r),a(C,{ref:"dt",value:e.cluster,page:e.page,lazy:"",paginator:"",scrollable:!0,"scroll-height":e.tableheigth+"px",totalRecords:e.totalrecords,loading:e.loading,rows:e.rows,stripedRows:"","paginator-template":"PrevPageLink NextPageLink CurrentPageReport","rows-per-page-options":[10,20,100],"current-page-report-template":"{totalRecords}件中 {first}件目 〜 {last}件目表示中","responsive-layout":"scroll"},{empty:d(()=>[te]),header:d(()=>[e.isSp?(l(),c("div",ne,[ae,i("span",re,[a(n,{label:"",icon:"pi pi-plus",class:"p-button-rounded p-button-info ml-5",onClick:s[0]||(s[0]=t=>e.showEdit(null))}),a(n,{label:"",icon:"pi pi-search",class:"p-button-rounded p-button-primary ml-2",onClick:s[1]||(s[1]=t=>e.spsearchDialog=!0)})])])):(l(),c("div",oe,le)),e.isSp?f("",!0):(l(),c("div",de,[ue,i("span",ce,[i("span",pe,[a(m,{modelValue:e.searchword,"onUpdate:modelValue":s[2]||(s[2]=t=>e.searchword=t),placeholder:"Search...",onKeypress:s[3]||(s[3]=k(t=>e.searchlocal(),["enter"]))},null,8,["modelValue"]),e.searchword?(l(),c("i",{key:0,class:"pi pi-times",onClick:s[4]||(s[4]=t=>e.searchword="")})):f("",!0)]),a(n,{label:"検索",icon:"pi pi-search",class:"p-button-primary ml-2",onClick:s[5]||(s[5]=t=>e.searchlocal())})])]))]),default:d(()=>[a(h,{field:"email",header:"メールアドレス"},{body:d(t=>[me,a(n,{type:"button",class:"m-2 p-button-outlined",label:g(b).formatFirestoreDoc(e.cluster[t.index],t.field),onClick:v=>e.quickPush("email",g(b).formatFirestoreDoc(e.cluster[t.index],t.field))},null,8,["label","onClick"])]),_:1}),S?(l(),p(h,{key:0,field:"name",header:"氏名",style:{"min-width":"100px"}},{body:d(t=>[he,y(" "+w(g(b).formatFirestoreDoc(e.cluster[t.index],t.field)),1)]),_:1})):f("",!0),_?(l(),p(h,{key:1,field:"tel",header:"電話番号",style:{"min-width":"100px"}},{body:d(t=>[fe,y(" "+w(g(b).formatFirestoreDoc(e.cluster[t.index],t.field)),1)]),_:1})):f("",!0),a(h,{field:"devicetokens",header:"Pushトークン"},{body:d(t=>[ge,(l(!0),c(O,null,G(g(b).formatFirestoreDoc(e.cluster[t.index],t.field).split(`
`),v=>(l(),p(n,{type:"button",class:"m-2",style:{"word-break":"break-all","font-size":"x-small"},label:v,onClick:Te=>e.quickPush("fcmtoken",v)},null,8,["label","onClick"]))),256))]),_:1}),a(h,{field:"modifydate",header:"最終アクセス",style:{width:"200px"}},{body:d(t=>[be,y(" "+w(g(b).formatFirestoreDoc(e.cluster[t.index],t.field)),1)]),_:1}),a(h,{field:"registerdate",header:"登録日",style:{width:"200px"}},{body:d(t=>[we,y(" "+w(g(b).formatFirestoreDoc(e.cluster[t.index],t.field)),1)]),_:1}),a(h,{style:{width:"150px"}},{body:d(t=>[g(b).formatFirestoreDoc(e.cluster[t.index],"uid")?(l(),p(n,{key:0,icon:"pi pi-pencil",class:"isdataresolve p-button-rounded p-button-info mr-2",onClick:v=>e.showEdit(t.index)},null,8,["onClick"])):f("",!0),g(b).formatFirestoreDoc(e.cluster[t.index],"uid")?(l(),p(n,{key:1,icon:"pi pi-trash",class:"p-button-rounded p-button-danger",onClick:v=>e.confirmRemove(t.index)},null,8,["onClick"])):f("",!0)]),_:1})]),_:1},8,["value","page","scroll-height","totalRecords","loading","rows"]),a(D,{visible:e.spsearchDialog,"onUpdate:visible":s[11]||(s[11]=t=>e.spsearchDialog=t),style:{width:"450px"},header:"キーワード検索",modal:!0,dismissableMask:!0},{footer:d(()=>[a(n,{label:"キャンセル",icon:"pi pi-times",class:"p-button-text",onClick:s[9]||(s[9]=t=>e.spsearchDialog=!1)}),a(n,{label:"検索",icon:"pi pi-search",class:"p-button-info",onClick:s[10]||(s[10]=t=>e.search(null))})]),default:d(()=>[i("div",ye,[i("span",ve,[a(m,{modelValue:e.searchword,"onUpdate:modelValue":s[6]||(s[6]=t=>e.searchword=t),placeholder:"Search...",onKeypress:s[7]||(s[7]=k(t=>e.search(null),["enter"]))},null,8,["modelValue"]),e.searchword?(l(),c("i",{key:0,class:"pi pi-times",onClick:s[8]||(s[8]=t=>e.searchword="")})):f("",!0)])])]),_:1},8,["visible"]),a(D,{visible:e.detailDialog,"onUpdate:visible":s[18]||(s[18]=t=>e.detailDialog=t),style:M({width:e.windowsize>834?"calc(100% - 300px - 4rem)":"100%"}),header:"メーカー情報",modal:!0,class:"fullscreen p-fluid",position:"right",dismissableMask:!0},{footer:d(()=>[e.isdetail?(l(),p(n,{key:0,label:"閉じる",icon:"pi pi-times",class:"p-button-danger",onClick:s[15]||(s[15]=t=>e.detailDialog=!1)})):(l(),p(n,{key:1,label:"キャンセル",icon:"pi pi-times",class:"p-button-danger",onClick:s[16]||(s[16]=t=>e.isnew?e.detailDialog=!1:e.isdetail=!0)})),e.isdetail?(l(),p(n,{key:2,label:"編集",icon:"pi pi-check",class:"p-button-info",onClick:s[17]||(s[17]=t=>e.isdetail=!1)})):(l(),p(n,{key:3,label:"保存",icon:"pi pi-check",class:"p-button-info",onClick:e.save},null,8,["onClick"]))]),default:d(()=>[i("div",ke,[Ce,e.isdetail?(l(),c("div",De,[i("b",null,w(e.one.name),1)])):(l(),p(m,{key:1,id:"name",modelValue:e.one.name,"onUpdate:modelValue":s[12]||(s[12]=t=>e.one.name=t),modelModifiers:{trim:!0},required:"true",type:"text",class:P({"p-invalid":e.submitted&&!e.one.name}),onKeypress:k(e.save,["enter"])},null,8,["modelValue","class","onKeypress"])),e.submitted&&!e.one.name?(l(),c("small",$e,"メーカー名は必須項目です。")):f("",!0)]),i("div",Ve,[Ee,e.isdetail?(l(),c("div",Pe,[i("b",null,[i("a",{href:e.one.url,target:"_blank"},w(e.one.url),9,ze)])])):(l(),p(m,{key:1,id:"name",modelValue:e.one.url,"onUpdate:modelValue":s[13]||(s[13]=t=>e.one.url=t),modelModifiers:{trim:!0},type:"text",onKeypress:k(e.save,["enter"])},null,8,["modelValue","onKeypress"]))]),i("div",Se,[_e,e.isdetail?(l(),c("div",Fe,[e.one.rank?(l(),c("small",Le,w(e.one.rank),1)):(l(),c("small",Re,"指定なし"))])):(l(),p(F,{key:1,id:"name",modelValue:e.one.rank,"onUpdate:modelValue":s[14]||(s[14]=t=>e.one.rank=t),modelModifiers:{trim:!0},type:"number",class:P({"p-invalid":e.submitted&&!e.one.rank}),onKeypress:k(e.save,["enter"])},null,8,["modelValue","class","onKeypress"]))])]),_:1},8,["visible","style"]),a(D,{visible:e.removeDialog,"onUpdate:visible":s[20]||(s[20]=t=>e.removeDialog=t),style:{width:"450px"},header:"最終確認",modal:!0,dismissableMask:!0},{footer:d(()=>[a(n,{label:"キャンセル",icon:"pi pi-times",class:"p-button-danger",onClick:s[19]||(s[19]=t=>e.removeDialog=!1)}),a(n,{label:"削除",icon:"pi pi-check",class:"p-button-info",onClick:e.remove},null,8,["onClick"])]),default:d(()=>[i("div",Ke,[Ne,e.one?(l(),c("span",Ue,[y("この管理者「"),i("b",null,w(e.one.name),1),y("」を削除します。"),Be,y("本当に削除してよろしいですか？?")])):f("",!0)])]),_:1},8,["visible"])])])])}}});const ds=X(Me,[["__scopeId","data-v-f650be0e"]]);export{ds as default};
